name: Linting CI

on: [pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v3
        with:
          version: 8

      - name: Update packages
        run: sudo apt update
      
      - name: Install dependencies
        run: sudo apt install ca-certificates curl gnupg

      - name: Create directory
        run: sudo mkdir -p /etc/apt/keyrings

      - name: Add repository key
        run: curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg

      - name: Add node version repository
        run: echo "deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_20.11 nodistro main" | sudo tee /etc/apt/sources.list.d/nodesource.list

      - name: Update repositories
        run: sudo apt update

      - name: Install node 20.11
        run: sudo apt install nodejs

      - name: Install dependencies
        run: pnpm install --ignore-scripts

      - name: Install nx
        run: sudo npm install -g nx

      - name: Run Linter
        run: nx lint --fix
